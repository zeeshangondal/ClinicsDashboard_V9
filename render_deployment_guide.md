# ClinicsDashboard V9 - Render Deployment Guide

This guide provides instructions for deploying the ClinicsDashboard V9 application on Render. The application consists of two separate Flask services:

1.  **`frontend_flask_app`**: This Flask application serves the pre-built React frontend.
2.  **`backend_flask_app`**: This is the main Flask application providing the API backend.

## Project Structure

The provided zip file contains two main directories:

-   `frontend_flask_app/`: Contains the Flask application responsible for serving the React frontend.
-   `backend_flask_app/`: Contains the main Flask API backend application.

Each directory is a self-contained Flask project with its own `requirements.txt` and `src/` directory.

## Deployment Steps on Render

You will deploy each Flask application as a separate Web Service on Render.

### 1. Deploying the `backend_flask_app` (API Backend)

This service will host your main API endpoints and manage the database.

**a. Create a New Web Service on Render:**

1.  Go to your Render Dashboard.
2.  Click "New" -> "Web Service".
3.  Connect your Git repository (where you will upload this project).
4.  In the "Root Directory" field, specify `backend_flask_app/`.

**b. Configuration:**

-   **Name:** `clinics-dashboard-backend` (or your preferred name)
-   **Region:** Choose a region close to your users.
-   **Branch:** `main` (or your deployment branch)
-   **Runtime:** `Python 3`
-   **Build Command:** `pip install -r requirements.txt`
-   **Start Command:** `gunicorn --worker-class geventwebsocket.gunicorn.workers.GeventWebSocketWorker -w 1 src.main:app`
    *Note: The `geventwebsocket` worker is used because the application uses Flask-SocketIO. If you encounter issues, you can try `gunicorn -w 4 src.main:app` but SocketIO might not function correctly.*

**c. Environment Variables:**

Add the following environment variables under "Environment":

-   `SECRET_KEY`: A strong, random string for Flask sessions (e.g., generated by `os.urandom(24)` in Python).
-   `JWT_SECRET_KEY`: A strong, random string for JWT tokens.
-   `CORS_ORIGINS`: Set this to the URL of your deployed `frontend_flask_app` (e.g., `https://your-frontend-app.onrender.com`). If you need to allow multiple origins, separate them with commas (e.g., `https://your-frontend-app.onrender.com,http://localhost:3000`). For development, you can use `*` but it's not recommended for production.
-   `DATABASE_URL`: Render automatically provides a PostgreSQL database. You can connect it by going to "Add-ons" -> "PostgreSQL" and linking it to this service. Render will then automatically set this variable.
-   `REDIS_URL`: If you plan to use Redis for caching or other features, add a Redis instance via "Add-ons" -> "Redis" and link it. Render will set this variable.

**d. Database Migrations (First Deployment Only):**

After the first successful deployment of the backend service, you need to initialize and apply database migrations. You can do this via Render's Shell:

1.  Go to your `clinics-dashboard-backend` service dashboard on Render.
2.  Click on the "Shell" tab.
3.  Run the following commands one by one:
    ```bash
    flask db init
    flask db migrate -m "Initial migration"
    flask db upgrade
    ```
    *Note: If you encounter issues with `flask db init`, ensure your `src/main.py` has `app, socketio = create_app()` at the top level and `FLASK_APP=src/main.py` is set as an environment variable or in your shell before running Flask commands.*

### 2. Deploying the `frontend_flask_app` (Frontend)

This service will serve your React frontend.

**a. Create a New Web Service on Render:**

1.  Go to your Render Dashboard.
2.  Click "New" -> "Web Service".
3.  Connect your Git repository.
4.  In the "Root Directory" field, specify `frontend_flask_app/`.

**b. Configuration:**

-   **Name:** `clinics-dashboard-frontend` (or your preferred name)
-   **Region:** Same as your backend for better performance.
-   **Branch:** `main` (or your deployment branch)
-   **Runtime:** `Python 3`
-   **Build Command:** `pip install -r requirements.txt`
-   **Start Command:** `gunicorn src.main:app`

**c. Environment Variables:**

Add the following environment variables under "Environment":

-   `SECRET_KEY`: A strong, random string for Flask sessions.
-   `JWT_SECRET_KEY`: A strong, random string for JWT tokens (should match the backend).
-   `CORS_ORIGINS`: Set this to `*` or the specific domain(s) from which your frontend will be accessed.

### 3. Connecting Frontend to Backend

Once both services are deployed, the frontend needs to know where to find the backend API. The `frontend_flask_app` is configured to use relative paths for API calls, which works well when both are deployed under the same domain (e.g., using Render's Private Services or a custom domain setup).

If you are using Render's default public URLs, you will need to update the frontend's JavaScript to point to the `backend_flask_app`'s URL. You can do this by modifying the `src/static/index-*.js` files within the `frontend_flask_app` after deployment (or before building if you have the React source). Look for API call URLs and replace them with the full URL of your deployed backend (e.g., `https://your-backend-app.onrender.com/api`).

**Example modification (conceptual, as exact file/line may vary):**

In `frontend_flask_app/src/static/index-*.js` (or similar JavaScript file serving API calls):

Find:
`fetch('/api/auth/login', ...)`

Replace with:
`fetch('https://your-backend-app.onrender.com/api/auth/login', ...)`

**Important:** Since the React frontend is pre-built, direct modification of the JavaScript files on Render might be challenging. A better approach would be to:

1.  **If you have the original React source code:** Modify the API base URL in the React source (e.g., in an environment variable or config file) and then rebuild the React project. Then, replace the contents of `frontend_flask_app/src/static` with the new build.
2.  **If you don't have the original React source:** You might need to use a proxy or rewrite rules on Render to redirect `/api` requests from the frontend service to the backend service. This is an advanced configuration and might require Render support or custom Nginx/Caddy setup if Render allows it.

For this package, the `frontend_flask_app` is set up to serve the pre-built static files. You will need to ensure the API calls from the frontend correctly target your deployed `backend_flask_app`.

## Final Notes

-   Ensure your Git repository is clean and only contains the `frontend_flask_app` and `backend_flask_app` directories at the root level for easy deployment on Render.
-   Monitor your Render service logs for any errors during build or runtime.
-   For persistent data, ensure your PostgreSQL database is correctly linked to the `backend_flask_app`.

This guide should provide you with all the necessary information to deploy the ClinicsDashboard V9 on Render. If you encounter any specific issues, refer to Render's documentation or their support.

